# YubiOn FIDO2 Server Service SDK デモ

これは、YubiOn FIDO2 Server Service SDKをサーバーサイド（Node.js/Express）およびクライアントサイド（Vue.js）で利用する方法を示すサンプルアプリケーションです。

このアプリケーションは、FIDO2パスキーを使用した基本的なユーザー登録およびログイン機能を提供します。

## 事前準備

サンプルを実行する前に、FSS管理WEBでRP関連の設定を行う必要があります。

1.  **RP（Relying Party）の登録**
    *   FSS管理WEBで、アプリケーションを新しいRPとして登録します。
    *   開発用途の場合、RPIDとして`.localhost`で終わる任意のドメイン名を使用できます（例: `your-app.localhost`）。

2.  **APIキーの作成**
    *   登録したRPに対して、新しいAPIキーを作成します。
    *   **API認証種別**は、「**Nonce署名認証**」を選択してください。

3.  **環境変数の設定**
    *   `sample/server`ディレクトリに、`.env.sample`ファイルをコピーして`.env`ファイルを作成します。
    *   `FSS_RP_ID`、`FSS_API_KEY_ID`、`FSS_API_SECRET`に、FSS管理WEBで取得した情報を設定します。
    *   `SESSION_SECRET`には、ユーザーセッションを保護するための長くランダムな文字列を設定します。
    *   `CLIENT_ORIGIN_URL`には、クライアントアプリケーションのURL（例: `http://your-app.localhost:5173`）を設定します。これはCORS設定に必要です。

## アプリケーションの実行

### 1. バックエンドサーバーの起動

```bash
# serverディレクトリに移動
cd server

# 依存関係をインストール
npm ci

# 開発サーバーを起動
npm run dev
```
サーバーが `http://localhost:3000` で起動します。

### 2. フロントエンドクライアントの起動

```bash
# clientディレクトリに移動
cd client

# 依存関係をインストール
npm ci

# 開発サーバーを起動
npm run dev
```
クライアントの開発サーバーが `http://localhost:5173` のようなポートで起動します。

### 3. アプリケーションへのアクセス

パスキーの登録と認証を正しく機能させるためには、`localhost`ではなく、設定した**RPID**を使用してアプリケーションにアクセスする必要があります。

1.  ブラウザを開き、以下のアドレスにアクセスします。
    `http://<あなたのRPID>:<クライアントのポート番号>`

    例えば、RPIDが `your-app.localhost` で、クライアントのポートが `5173` の場合、`http://your-app.localhost:5173` にアクセスします。

    *補足1: `.localhost`ドメイン以外を使用している場合、ローカルの`hosts`ファイルを編集して、RPIDを`127.0.0.1`に向ける必要がある場合があります。*  
    *補足2: 暗号化されていないHTTPによる通信でのパスキー認証は、ローカル以外のドメインへのアクセス時は許可されません。正式なサービスなどで用いる場合はHTTPSでの通信が必須です。*  

### 4. APIログの確認

このサンプルアプリケーションからFSSへのAPI呼び出しは、FSS管理WEBコンソールで確認できます。

*   登録したRPの **RP詳細** -> **APIログ** に移動して確認してください。
